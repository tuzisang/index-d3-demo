好的，这是一个为你的项目量身定制的 `README.md` 文件。它包含了项目的介绍、功能、如何运行、使用方法、技术栈以及未来的改进方向。

---

# 全景血缘图生成器 (Cytoscape版)

## 🚀 项目简介

本项目是一个基于 Next.js 和 Cytoscape.js 开发的交互式全景血缘图生成器。它允许用户上传特定的 Excel 文件，自动解析文件中的数据，并将其可视化为直观的血缘关系图（DAG，有向无环图）。用户可以轻松地查看数据流向、追溯数据来源，并进行图表的交互操作，如缩放、平移、节点高亮及图片导出。

**核心价值：** 简化复杂数据血缘关系的理解和分析，提高数据治理和问题排查的效率。

## ✨ 主要功能

*   **Excel 文件解析：** 支持上传 `.xlsx` 和 `.xls` 格式的 Excel 文件，自动读取并解析数据。
*   **自动化图表生成：** 根据 Excel 文件中的特定列数据，自动构建节点和边，生成有向无环图（DAG）。
*   **交互式可视化：**
    *   **节点高亮：** 点击任意节点，自动高亮显示其所有上游（源头）节点及其连接边，方便追溯数据链路。
    *   **节点名称复制：** 点击节点时，其名称会自动复制到剪贴板，方便快速使用。
    *   **拖拽与缩放：** 支持鼠标拖拽平移图表，滚轮缩放视图。
    *   **重置视图：** 一键将图表恢复到初始布局和缩放状态。
*   **图片导出：** 支持将当前生成的血缘图导出为 PNG 格式图片，便于分享和存档。
*   **加载状态提示：** 在文件处理过程中显示加载动画和提示信息，提升用户体验。
*   **响应式设计：** 界面适配不同屏幕尺寸，提供良好的用户体验。

## 🛠️ 技术栈

*   **前端框架：** [Next.js](https://nextjs.org/) (React)
*   **图表库：** [Cytoscape.js](https://cytoscape.org/)
*   **布局算法：** [Cytoscape-Dagre](https://github.com/cytoscape/cytoscape.js-dagre) (基于 Dagre 布局算法，优化有向图显示)
*   **Excel 解析：** [SheetJS (js-xlsx)](https://sheetjs.com/)
*   **图表交互扩展：** [Cytoscape-Edgehandles](https://github.com/cytoscape/cytoscape.js-edgehandles) (用于未来可能的边编辑功能，当前主要用于初始化)
*   **样式：** CSS Modules (通过 Next.js 的 `jsx` 样式)

## 🚀 如何运行项目

### 前提条件

*   Node.js (推荐 LTS 版本，如 18.x 或更高)
*   npm 或 Yarn

### 步骤

1.  **克隆仓库：**
    ```bash
    git clone <你的仓库地址>
    cd <项目目录>
    ```
2.  **安装依赖：**
    ```bash
    npm install
    # 或者
    yarn install
    ```
3.  **运行开发服务器：**
    ```bash
    npm run dev
    # 或者
    yarn dev
    ```
    项目将在 `http://localhost:3000` 启动。

4.  **构建生产版本 (可选)：**
    ```bash
    npm run build
    # 或者
    yarn build
    ```
    然后启动生产服务器：
    ```bash
    npm run start
    # 或者
    yarn start
    ```

## 💡 使用指南

1.  **准备 Excel 文件：**
    *   确保您的 Excel 文件包含血缘关系数据。
    *   本项目默认从 Excel 的特定列读取数据以构建血缘关系。根据代码中的 `COLUMN_CHAIN` 和 `COLUMN_MAP` 常量，它期望数据从第 5 行开始（索引为 4），并依次读取以下列：
        *   `W` 列 (索引 22) 作为根节点或起始节点。
        *   `AN` 列 (索引 39)
        *   `BE` 列 (索引 56)
        *   `BV` 列 (索引 73)
        *   `CM` 列 (索引 90)
        *   `DD` 列 (索引 107)
        *   `DV` 列 (索引 125)
    *   这些列中的值将作为图表的节点名称，并按照列的顺序形成父子关系。空值或 `/` 将被跳过。
    *   **示例数据结构 (简化示意):**
        | ... | W (22) | ... | AN (39) | ... | BE (56) | ... |
        | --- | ------ | --- | ------- | --- | ------- | --- |
        | ... | Data_A | ... | Process_1 | ... | Output_X | ... |
        | ... | Data_A | ... | Process_2 | ... | Output_Y | ... |
        | ... | Data_B | ... | Process_3 | ... | Output_Z | ... |
        *这会生成类似 `Data_A -> Process_1 -> Output_X` 的血缘链。*

2.  **上传文件：**
    *   点击页面上的 "选择Excel文件" 按钮。
    *   选择您准备好的 Excel 文件 (`.xlsx` 或 `.xls` 格式)。
    *   文件上传后，系统将自动解析并生成血缘图。

3.  **交互操作：**
    *   **平移：** 鼠标左键按住图表空白区域拖动。
    *   **缩放：** 鼠标滚轮向上/向下滚动。
    *   **高亮上游：** 点击任意节点，该节点及其所有上游节点（数据来源）和连接它们的边将高亮显示。再次点击已高亮的节点或点击图表空白区域可取消高亮。
    *   **复制节点名称：** 点击节点时，其显示的名称会自动复制到剪贴板。
    *   **重置视图：** 点击 "重置视图" 按钮，图表将恢复到初始的居中和缩放状态。
    *   **下载图片：** 点击 "下载为图片" 按钮，当前图表将导出为 PNG 格式图片。

## 🏗️ 项目结构

```
.
├── public/
├── src/
│   ├── pages/
│   │   └── index.js  # 主页面，包含所有逻辑和UI
│   └── styles/
│       └── globals.css # 全局样式 (如果需要)
├── .env.local          # 环境变量 (如果需要)
├── next.config.js      # Next.js 配置
├── package.json        # 项目依赖和脚本
├── README.md           # 本文件
└── ...
```

## 💡 优化与改进

*   **更灵活的列配置：** 当前列是硬编码的，未来可以考虑通过用户界面或配置文件动态配置需要解析的 Excel 列。
*   **错误处理增强：** 对 Excel 数据格式不匹配、空数据等情况提供更详细的用户友好提示。
*   **性能优化：** 对于超大型 Excel 文件，考虑使用 Web Workers 进行数据解析，避免阻塞主线程。
*   **布局算法选择：** 允许用户选择不同的布局算法（如 `cose`, `cola` 等），以适应不同类型的图表展示需求。
*   **节点信息展示：** 鼠标悬停在节点上时显示更多详细信息（如来自 Excel 的其他列数据）。
*   **搜索/过滤功能：** 允许用户搜索特定节点或根据关键词过滤图表。
*   **保存/加载图表状态：** 除了导出图片，还可以考虑保存图表的当前布局和高亮状态。
*   **样式定制：** 提供更多样式定制选项，如节点颜色、字体大小等。
*   **单元测试/集成测试：** 增加测试覆盖率，确保代码质量和稳定性。

## 🤝 贡献

欢迎任何形式的贡献！如果您有任何建议、功能请求或 Bug 报告，请随时提交 Issue 或 Pull Request。

## 📄 许可证

本项目采用 MIT 许可证。

---